<!-- 
* KINOVA (R) KORTEX (TM)
*
* Copyright (c) 2018 Kinova inc. All rights reserved.
*
* This software may be modified and distributed under the
* terms of the BSD 3-Clause license.
*
* Refer to the LICENSE file for details.
*
* -->

# Kortex actuator driver
This package is a node that interfaces with a single actuator.

<!-- MarkdownTOC -->

1. [Content](#content)
    1. [build](#build)
    1. [msg](#msg)
        1. [non_generated](#non_generated)
    1. [protos](#protos)
    1. [src](#src)
    1. [srv](#srv)
        1. [non_generated](#non_generated-1)
    1. [templates](#templates)
1. [How to start the node](#how-to-start-the-node)
    1. [Normal mode](#normal-mode)
    1. [Using the device routing feature](#using-the-device-routing-feature)
1. [Generation](#generation)

<!-- /MarkdownTOC -->

<a id="content"></a>
## Content
<a id="build"></a>
### build
This folder's only purpose is to exist as a temp folder during the generation. It should not be used.
<a id="msg"></a>
### msg
This folder contains every custom messages used by the node **kortex\_actuator\_driver**. All the .msg files in this folder are generated by a custom protoc plugin described in the [Generation](#generation) section. 
<a id="non_generated"></a>
#### non_generated
This folder contains all the non-generated .msg files used by the node **kortex\_actuator\_driver**.

| MSG | Description |
|:---:|:---:|
| ApiOptions.msg | A set of option that is supported by the Kortex API. It is used with the service SetApiOptions. For now there is only one option called tiemout_ms and it lets the user set a timeout value on every next service call. |
| KortexError.msg | Describe the topic /KortexError. Every service call of the node kortex_actuator_driver will publish in /KortexError everytime the Kortex API returns an error. |

<a id="protos"></a>
### protos
This folder contains the protobuf files from where the MSG, SRV and sources files are generated. The content of this folder should not be modified.
<a id="src"></a>
### src
This folder contains all the generated source files needed to build the node. The content of this folder should not be modified.
<a id="srv"></a>
### srv
This folder contains every custom services used by the node **kortex\_actuator\_driver**. All the .srv files in this folder are generated by a custom protoc plugin described in the [Generation](#generation) section. 
<a id="non_generated-1"></a>
#### non_generated
This folder contains all the non-generated .srv files used by the node **kortex\_actuator\_driver**.

| SRV | Description |
|:---:|:---:|
| SetApiOptions.srv | It modify the api options of the Kortex API. Once this service is called, the options set will affect every future call to the node. |
| SetDeviceID.srv | It modify the target device (device routing feature) of the node. The default value is 0.|

<a id="templates"></a>
### templates
This folder contains all the JINJA2 files needed by the protoc generator. For more details on the generation process, see the [Generation](#generation) section.

| JINJA2 files | Description |
|:---:|:---:|
| main.jinja2 | Use to generate src/main.cpp |
| NodeServices.cpp.jinja2 | Use to generate src/node.cpp |
| NodeServices.h.jinja2 | Use to generate src/node.h |
| proto_converterCPP.jinja2 | Use to generate every src/*_proto\_converter.cpp files |
| proto_converterHeader.jinja2 | Use to generate every src/*_proto\_converter.h files |
| ros_converterCPP.jinja2 | Use to generate every src/*_ros\_converter.cpp files |
| ros_converterHeader.jinja2 | Use to generate every src/*_proto\_converter.h files |
| ros_enum.jinja2 | Use to generate every msg/*.msg files that represent a protobuf enum |
| ros_message.jinja2 | Use to generate every msg/*.msg files that represent a protobuf message |
| ros_oneof.jinja2 | Use to generate every msg/*.msg files that represent a protobuf oneof |
| ros_service.jinja2 | Use to generate every msg/*.msg files that represent a protobuf RPC |

<a id="how-to-start-the-node"></a>
## How to start the node
<a id="normal-mode"></a>
### Normal mode
Use this mode if you are directly (there is an ethernet cable between your computer and an actuator) connected to an actuator. To be clear, if you are using the WIFI or your cable is connected in the robot's base, don't use this mode.

<code>rosrun kortex\_actuator\_driver kortex\_actuator\_driver 192.168.1.10 100</code>

In the command above, you would be running the kortex_actuator_driver node on an actuator with an IP address of 192.168.1.10. The cyclic data would be refreshed at 100 Hz.

<a id="using-the-device-routing-feature"></a>
### Using the device routing feature
Use this mode if your are connected via WIFI are directly in the robot's base and you want to have access to an actuator's interface.

<code>rosrun kortex\_actuator\_driver kortex\_actuator\_driver 192.168.1.10 100 4</code>

In the command above, you would be running the kortex_actuator_driver node using the device routing feature on an robot's base with an IP address of 192.168.1.10. The cyclic data would be refreshed at 100 Hz and the actuator's device ID is 4.

<a id="generation"></a>
## Generation
<p>
The generation process is based on a custom protobuf plugin. Basically, most of the generation process is in the python file RosGeneration.py located at the package's root folder. Before launching the generation make sure you have the python module Jinja2 installed on your computer.
</p>

To launch the generation of this package:

1. Open a terminal window.
1. Browse the root of this package [YOUR\_ROS\_WORKSPACE]/src/ros\_kortex/kortex\_actuator\_driver/
1. Make sure that the file kortex_actuator_driver.sh can be executed. If not then <code>chmod +x kortex_actuator_driver.sh</code>
1. Run this command: <code>protoc --plugin=protoc-gen-custom=kortex_actuator_driver.sh -I./protos/ --custom_out=./build ./protos/\*.prot</code>
1. The result of the generation should be on thos folder:
    * /src
    * /msg
    * /srv

